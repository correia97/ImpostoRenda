version: 2.0
jobs:
 build:
   docker:
     - image: mcr.microsoft.com/dotnet/core/sdk:2.2
   steps:
     - checkout
     - run:
         name: Install Sonar
         command:
           dotnet tool install --global dotnet-sonarscanner --version 4.6.2
     - run:
         name: Start Sonar
         command:
           dotnet sonarscanner begin /k:"correia97_ImpostoRendaLB3" \
                                     -/d:sonar.organization="correia97" \
                                     -/d:sonar.host.url="https://sonarcloud.io" \
                                     -/d:sonar.login="b957fd86f5bbd1346a2828f4360a77f68e63f8e3" \
                                     -/d:sonar.cs.opencover.reportsPaths="Tests/ImpostoRendaLB3.UnitTests/coverage.opencover.xml"         
     - run:
         name: Restore packages
         command:
           dotnet restore
     - run:
         name: Build App
         command:
           dotnet build
     - run:
         name: Run Test
         command:
           dotnet test --no-build /p:CollectCoverage=true  /p:CoverletOutputFormat=\"cobertura,opencover\"
     - run:
         name: Run Test
         command:
           dotnet sonarscanner end /d:sonar.login="b957fd86f5bbd1346a2828f4360a77f68e63f8e3"           
workflows:
  version: 2
  build_and_test:
    jobs:
      - build           
