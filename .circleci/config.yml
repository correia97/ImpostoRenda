version: 2.0
jobs:
 build:
   docker:
     - image: mcr.microsoft.com/dotnet/core/sdk:2.2
   steps:
     - checkout
     - run:
         name: Restore packages
         command:
           dotnet restore
     - run:
         name: Build App
         command:
           dotnet build
     - run:
         name: Run Test
         command:
           dotnet test --no-build /p:CollectCoverage=true  /p:CoverletOutputFormat=\"cobertura,opencover\" /p:CoverletOutput=\"results\"
     - store_artifacts:
          path: Tests/ImpostoRendaLB3.UnitTests/results
 dockerbuild:
    machine:
      image: ubuntu-1604:latest 
    steps:
      - run:
          name: docker build
          command: docker build -t imp:v1 .
workflows:
  version: 2
  build_and_test:
    jobs:
      - build  
      - dockerbuild